<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetMeet ÁÆ°ÁêÜÈù¢Êùø</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
    </style>
    <script>
        // ËÆ§ËØÅÊ£ÄÊü•ÔºàÂ¢ûÂº∫ÁâàÔºâ
        window.addEventListener('load', function() {
            console.log('üöÄ ÁÆ°ÁêÜÈù¢ÊùøÈ°µÈù¢Âä†ËΩΩÂºÄÂßã');
            
            const token = localStorage.getItem('adminToken');
            const user = localStorage.getItem('adminUser');
            
            console.log('üîê Ê£ÄÊü•ËÆ§ËØÅÁä∂ÊÄÅ', {
                hasToken: !!token,
                hasUser: !!user,
                tokenLength: token ? token.length : 0,
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString()
            });
            
            if (!token) {
                console.warn('‚ùå Êú™ÊâæÂà∞ËÆ§ËØÅ‰ª§ÁâåÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ');
                window.location.href = '/login.html';
                return;
            }
            
            // È™åËØÅtoken
            console.log('üîç È™åËØÅËÆ§ËØÅ‰ª§Áâå...', {
                tokenPrefix: token.substring(0, 20) + '...',
                validationUrl: '/api/admin/auth/validate'
            });
            
            const validationStartTime = Date.now();
            
            fetch('/api/admin/auth/validate', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                const validationDuration = Date.now() - validationStartTime;
                console.log('üì° ‰ª§ÁâåÈ™åËØÅÂìçÂ∫î', {
                    status: response.status,
                    statusText: response.statusText,
                    duration: validationDuration + 'ms',
                    headers: Object.fromEntries(response.headers.entries())
                });
                return response.json();
            })
            .then(result => {
                console.log('‚úÖ ‰ª§ÁâåÈ™åËØÅÁªìÊûú', {
                    success: result.success,
                    message: result.message,
                    user: result.user,
                    hasValidUser: !!result.user
                });
                
                if (!result.success) {
                    console.warn('‚ùå ‰ª§ÁâåÈ™åËØÅÂ§±Ë¥•ÔºåÊ∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®', {
                        reason: result.message,
                        action: 'redirect_to_login'
                    });
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('adminUser');
                    window.location.href = '/login.html';
                } else {
                    console.log('üéâ ËÆ§ËØÅÊàêÂäüÔºåÂáÜÂ§áÂàùÂßãÂåñÁÆ°ÁêÜÈù¢Êùø', {
                        userId: result.user?.id,
                        userName: result.user?.nickName,
                        timestamp: new Date().toISOString()
                    });
                }
            })
            .catch(error => {
                const validationDuration = Date.now() - validationStartTime;
                console.error('üö® ËÆ§ËØÅÈ™åËØÅÂ§±Ë¥•', {
                    errorName: error.name,
                    errorMessage: error.message,
                    errorStack: error.stack,
                    duration: validationDuration + 'ms',
                    action: 'clear_storage_and_redirect'
                });
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                window.location.href = '/login.html';
            });
        });

        // ÁõëÂê¨È°µÈù¢ÈîôËØØ
        window.addEventListener('error', (event) => {
            console.error('üö® È°µÈù¢JavaScriptÈîôËØØ', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno,
                error: event.error?.stack,
                timestamp: new Date().toISOString()
            });
        });

        // ÁõëÂê¨Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù
        window.addEventListener('unhandledrejection', (event) => {
            console.error('üö® Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù', {
                reason: event.reason,
                promise: event.promise,
                timestamp: new Date().toISOString()
            });
        });

        // ÁõëÂê¨ÁΩëÁªúÁä∂ÊÄÅÂèòÂåñ
        window.addEventListener('online', () => {
            console.log('üåê ÁΩëÁªúËøûÊé•Â∑≤ÊÅ¢Â§ç', {
                timestamp: new Date().toISOString(),
                connection: navigator.connection
            });
        });

        window.addEventListener('offline', () => {
            console.warn('üåê ÁΩëÁªúËøûÊé•Â∑≤Êñ≠ÂºÄ', {
                timestamp: new Date().toISOString()
            });
        });
    </script>
</head>
<body class="bg-gray-50 font-sans" x-data="adminPanel()" x-init="init()">
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="flex h-screen overflow-hidden">
        <!-- ‰æßËæπÂØºËà™ -->
        <div class="w-64 bg-white shadow-lg flex-shrink-0 overflow-y-auto">
            <div class="p-6 border-b">
                <h1 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-paw text-blue-500 mr-2"></i>
                    PetMeet ÁÆ°ÁêÜ
                </h1>
            </div>
            
            <nav class="mt-6">
                <div class="px-4 space-y-2">
                    <button @click="currentView = 'dashboard'" 
                            :class="currentView === 'dashboard' ? 'bg-blue-50 text-blue-600 border-r-2 border-blue-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors">
                        <i class="fas fa-chart-dashboard mr-3"></i>
                        ‰ª™Ë°®Êùø
                    </button>
                    
                    <button @click="currentView = 'users'" 
                            :class="currentView === 'users' ? 'bg-blue-50 text-blue-600 border-r-2 border-blue-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors">
                        <i class="fas fa-users mr-3"></i>
                        Áî®Êà∑ÁÆ°ÁêÜ
                    </button>
                    
                    <button @click="currentView = 'posts'" 
                            :class="currentView === 'posts' ? 'bg-blue-50 text-blue-600 border-r-2 border-blue-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors">
                        <i class="fas fa-file-text mr-3"></i>
                        Â∏ñÊñáÁÆ°ÁêÜ
                    </button>
                    
                    <button @click="currentView = 'ai-models'" 
                            :class="currentView === 'ai-models' ? 'bg-blue-50 text-blue-600 border-r-2 border-blue-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors">
                        <i class="fas fa-robot mr-3"></i>
                        AIÊ®°ÂûãÁÆ°ÁêÜ
                    </button>
                    
                    <button @click="currentView = 'ai-generation'" 
                            :class="currentView === 'ai-generation' ? 'bg-blue-50 text-blue-600 border-r-2 border-blue-600' : 'text-gray-600 hover:bg-gray-50'"
                            class="w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors">
                        <i class="fas fa-magic mr-3"></i>
                        AIÁîüÊàêÂ∑•ÂÖ∑
                    </button>
                </div>
            </nav>
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
            <header class="bg-white shadow-sm border-b px-6 py-4 flex-shrink-0">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-semibold text-gray-800" x-text="getViewTitle()"></h2>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500" x-text="'ÊúÄÂêéÊõ¥Êñ∞: ' + new Date().toLocaleString()"></span>
                        <button @click="logout()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            ÈÄÄÂá∫
                        </button>
                    </div>
                </div>
            </header>

            <!-- ‰∏ªÂÜÖÂÆπ -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- ‰ª™Ë°®ÊùøËßÜÂõæ -->
                <div x-show="currentView === 'dashboard'" x-cloak>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- ÁªüËÆ°Âç°Áâá -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                    <i class="fas fa-users text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">ÊÄªÁî®Êà∑Êï∞</p>
                                    <p class="text-2xl font-bold text-gray-900" x-text="stats.totalUsers"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-green-100 text-green-600">
                                    <i class="fas fa-file-text text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">ÊÄªÂ∏ñÊñáÊï∞</p>
                                    <p class="text-2xl font-bold text-gray-900" x-text="stats.totalPosts"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                                    <i class="fas fa-robot text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">AIÊ®°ÂûãÊï∞</p>
                                    <p class="text-2xl font-bold text-gray-900" x-text="stats.totalAIModels"></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 rounded-full bg-orange-100 text-orange-600">
                                    <i class="fas fa-comments text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">ÊÄªËØÑËÆ∫Êï∞</p>
                                    <p class="text-2xl font-bold text-gray-900" x-text="stats.totalComments"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áî®Êà∑ÁÆ°ÁêÜËßÜÂõæ -->
                <div x-show="currentView === 'users'" x-cloak>
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold">Áî®Êà∑ÂàóË°®</h3>
                                <div class="flex space-x-3">
                                    <input type="text" placeholder="ÊêúÁ¥¢Áî®Êà∑..." 
                                           x-model="userSearch"
                                           class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button @click="openUserModal()" 
                                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-plus mr-2"></i>Ê∑ªÂä†Áî®Êà∑
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="h-[calc(100vh-280px)] overflow-y-auto overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Áî®Êà∑</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PetMeet ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ê≥®ÂÜåÊó∂Èó¥</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Áä∂ÊÄÅ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="user in filteredUsers" :key="user._id">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="flex items-center">
                                                    <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                                                        <img x-show="user.avatarUrl" :src="user.avatarUrl" 
                                                             class="h-10 w-10 rounded-full object-cover"
                                                             @error="$el.style.display='none'">
                                                        <i x-show="!user.avatarUrl" class="fas fa-user text-gray-400"></i>
                                                    </div>
                                                    <div class="ml-4">
                                                        <div class="text-sm font-medium text-gray-900" x-text="user.nickName"></div>
                                                        <div class="text-sm text-gray-500" x-text="user._openid"></div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="user.PetMeetID"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(user.createTime)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span :class="user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'" 
                                                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                                                    <span x-text="user.status === 'active' ? 'Ê¥ªË∑É' : 'Á¶ÅÁî®'"></span>
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button @click="editUser(user)" class="text-blue-600 hover:text-blue-900 mr-3">ÁºñËæë</button>
                                                <button @click="deleteUser(user._id)" class="text-red-600 hover:text-red-900">Âà†Èô§</button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Â∏ñÊñáÁÆ°ÁêÜËßÜÂõæ -->
                <div x-show="currentView === 'posts'" x-cloak>
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold">Â∏ñÊñáÂàóË°®</h3>
                                <div class="flex space-x-3">
                                    <input type="text" placeholder="ÊêúÁ¥¢Â∏ñÊñá..." 
                                           x-model="postSearch"
                                           class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button @click="openPostModal()" 
                                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-plus mr-2"></i>Ê∑ªÂä†Â∏ñÊñá
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="h-[calc(100vh-280px)] overflow-y-auto overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ê†áÈ¢ò</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‰ΩúËÄÖ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÂèëÂ∏ÉÊó∂Èó¥</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Áä∂ÊÄÅ</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="post in filteredPosts" :key="post._id">
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4">
                                                <div class="text-sm font-medium text-gray-900" x-text="post.title || post.content?.substring(0, 50) + '...'"></div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="post.authorName"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(post.createTime)"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span :class="post.status === 'published' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'" 
                                                      class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                                                    <span x-text="post.status === 'published' ? 'Â∑≤ÂèëÂ∏É' : 'ËçâÁ®ø'"></span>
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button @click="editPost(post)" class="text-blue-600 hover:text-blue-900 mr-3">ÁºñËæë</button>
                                                <button @click="deletePost(post._id)" class="text-red-600 hover:text-red-900">Âà†Èô§</button>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- AIÊ®°ÂûãÁÆ°ÁêÜËßÜÂõæ -->
                <div x-show="currentView === 'ai-models'" x-cloak>
                    <div class="bg-white rounded-lg shadow">
                        <div class="p-6 border-b">
                            <div class="flex justify-between items-center">
                                <h3 class="text-lg font-semibold">AIÊ®°ÂûãÂàóË°®</h3>
                                <div class="flex space-x-3">
                                    <button @click="testAllAIModels()" 
                                            :disabled="aiModels.length === 0"
                                            class="bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-play-circle mr-2"></i>ÊµãËØïÊâÄÊúâÊ®°Âûã
                                    </button>
                                    <button @click="openAIModelModal()" 
                                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-plus mr-2"></i>Ê∑ªÂä†Ê®°Âûã
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6">
                            <template x-for="model in aiModels" :key="model._id">
                                <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-lg font-semibold" x-text="model.name"></h4>
                                        <span :class="model.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'" 
                                              class="px-2 py-1 text-xs rounded-full">
                                            <span x-text="model.status === 'active' ? 'Ê¥ªË∑É' : 'Á¶ÅÁî®'"></span>
                                        </span>
                                    </div>
                                    <p class="text-gray-600 text-sm mb-4" x-text="model.description"></p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-500" x-text="'ÁâàÊú¨: ' + model.version"></span>
                                        <div class="space-x-2">
                                            <button @click="testAIModel(model)" 
                                                    class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">
                                                ÊµãËØï
                                            </button>
                                            <button @click="editAIModel(model)" 
                                                    class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                                ÁºñËæë
                                            </button>
                                            <button @click="deleteAIModel(model._id)" 
                                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                                Âà†Èô§
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- AIÁîüÊàêÂ∑•ÂÖ∑ËßÜÂõæ -->
                <div x-show="currentView === 'ai-generation'" x-cloak>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Áî®Êà∑ÁîüÊàê -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="p-6 border-b">
                                <h3 class="text-lg font-semibold">
                                    <i class="fas fa-user-plus mr-2 text-blue-500"></i>
                                    AIÁîüÊàêÁî®Êà∑
                                </h3>
                            </div>
                            <div class="p-6 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©AIÊ®°Âûã</label>
                                    <select x-model="selectedAIModel" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">ËØ∑ÈÄâÊã©Ê®°Âûã</option>
                                        <template x-for="model in aiModels.filter(m => m.status === 'active')" :key="model._id">
                                            <option :value="model._id" x-text="model.name"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÁîüÊàêÊï∞Èáè</label>
                                    <input type="number" x-model="userGenerationCount" min="1" max="20" 
                                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <!-- È¢ÑËßàÂºÄÂÖ≥ -->
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700">È¢ÑËßàÊ®°Âºè</label>
                                        <p class="text-xs text-gray-500">ÂºÄÂêØÂêéÂèØÈ¢ÑËßàÂíåÁºñËæëÁîüÊàêÁöÑÁî®Êà∑‰ø°ÊÅØ</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" x-model="showUserPreview" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                
                                <button @click="generateUsers()" 
                                        :disabled="!selectedAIModel || userGenerationCount < 1"
                                        class="w-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white py-2 rounded-lg transition-colors">
                                    <i class="fas fa-magic mr-2"></i>
                                    <span x-text="showUserPreview ? 'ÁîüÊàêÁî®Êà∑È¢ÑËßà' : 'Áõ¥Êé•ÁîüÊàêÁî®Êà∑'"></span>
                                </button>
                            </div>
                            
                            <!-- Áî®Êà∑È¢ÑËßàÂå∫Âüü -->
                            <div x-show="previewUsers.length > 0" class="border-t">
                                <div class="p-4 bg-blue-50 border-b">
                                    <div class="flex justify-between items-center">
                                        <h4 class="font-medium text-blue-800">
                                            <i class="fas fa-eye mr-2"></i>
                                            Áî®Êà∑È¢ÑËßà (<span x-text="previewUsers.length"></span>‰∏™)
                                        </h4>
                                        <div class="flex space-x-2">
                                            <button @click="savePreviewUsers()" 
                                                    class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                                <i class="fas fa-save mr-1"></i>‰øùÂ≠òÂÖ®ÈÉ®
                                            </button>
                                            <button @click="clearPreviewUsers()" 
                                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                                <i class="fas fa-trash mr-1"></i>Ê∏ÖÁ©∫
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 max-h-96 overflow-y-auto">
                                    <div class="space-y-3">
                                        <template x-for="(user, index) in previewUsers" :key="index">
                                            <div class="border border-gray-200 rounded-lg p-3 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg">
                                                <div class="flex justify-between items-start mb-2">
                                                    <div class="flex items-center">
                                                        <img :src="user.avatarUrl || 'https://via.placeholder.com/40x40?text=User'" 
                                                             class="w-8 h-8 rounded-full object-cover mr-2"
                                                             @error="$el.src='https://via.placeholder.com/40x40?text=User'">
                                                        <div>
                                                            <h5 class="font-medium text-sm" x-text="user.nickName"></h5>
                                                            <p class="text-xs text-blue-600" x-text="'ID: ' + user.PetMeetID"></p>
                                                        </div>
                                                    </div>
                                                    <button @click="removePreviewUser(index)" 
                                                            class="text-red-500 hover:text-red-700 p-1">
                                                        <i class="fas fa-times text-xs"></i>
                                                    </button>
                                                </div>
                                                <div class="text-xs text-gray-600">
                                                    <p><strong>Á≠æÂêç:</strong> <span x-text="user.signature || user.bio"></span></p>
                                                    <p><strong>‰ΩçÁΩÆ:</strong> <span x-text="user.location || user.city"></span></p>
                                                    <p x-show="user.petInfo"><strong>ÂÆ†Áâ©:</strong> <span x-text="user.petInfo?.name + ' (' + user.petInfo?.category + ' - ' + user.petInfo?.common_name + ')'"></span></p>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Â∏ñÊñáÁîüÊàê -->
                        <div class="bg-white rounded-lg shadow">
                            <div class="p-6 border-b">
                                <h3 class="text-lg font-semibold">
                                    <i class="fas fa-file-plus mr-2 text-green-500"></i>
                                    AIÁîüÊàêÂ∏ñÊñá
                                </h3>
                            </div>
                            <div class="p-6 space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©AIÊ®°Âûã</label>
                                    <select x-model="selectedAIModelForPosts" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">ËØ∑ÈÄâÊã©Ê®°Âûã</option>
                                        <template x-for="model in aiModels.filter(m => m.status === 'active')" :key="model._id">
                                            <option :value="model._id" x-text="model.name"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÁîüÊàêÊï∞Èáè</label>
                                    <input type="number" x-model="postGenerationCount" min="1" max="15" 
                                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‰∏ªÈ¢òÂÖ≥ÈîÆËØçÔºàÂèØÈÄâÔºâ</label>
                                    <input type="text" x-model="postTopic" placeholder="‰æãÂ¶ÇÔºöÂÆ†Áâ©ÂÅ•Â∫∑„ÄÅËÆ≠ÁªÉÊäÄÂ∑ß..." 
                                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©ÂèëÂ∏ñ‰ΩúËÄÖ</label>
                                    <select x-model="selectedPostAuthor" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">ÈöèÊú∫ÈÄâÊã©ËôöÊãüÁî®Êà∑</option>
                                        <template x-for="user in virtualUsers" :key="user._id">
                                            <option :value="user._id" x-text="user.nickName + ' (ID: ' + user.PetMeetID + ')'"></option>
                                        </template>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">Âè™ÊòæÁ§∫AIÁîüÊàêÁöÑËôöÊãüÁî®Êà∑ÔºåÁ°Æ‰øùÂÜÖÂÆπÂÆâÂÖ®</p>
                                </div>
                                
                                <!-- AIÂõæÂÉèÁîüÊàêÂºÄÂÖ≥ -->
                                <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700">AIÂõæÂÉèÁîüÊàê</label>
                                        <p class="text-xs text-gray-500">ÂºÄÂêØÂêéÂ∞ÜÊ†πÊçÆÂ∏ñÊñáÂÜÖÂÆπËá™Âä®ÁîüÊàêÈÖçÂõæ</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" x-model="enableImageGeneration" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                    </label>
                                </div>
                                
                                <!-- ÂõæÂÉèÊ®°ÂûãÈÄâÊã© -->
                                <div x-show="enableImageGeneration" x-transition class="bg-purple-50 rounded-lg p-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©ÂõæÂÉèÊ®°Âûã</label>
                                    <select x-model="selectedImageModel" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="">Ëá™Âä®ÈÄâÊã©ÂèØÁî®ÁöÑÂõæÂÉèÊ®°Âûã</option>
                                        <template x-for="model in imageModels" :key="model._id">
                                            <option :value="model._id" x-text="model.name + ' (' + model.provider + ')'"></option>
                                        </template>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <span x-show="imageModels.length === 0" class="text-orange-600">
                                            <i class="fas fa-exclamation-triangle mr-1"></i>
                                            ÊöÇÊó†ÂèØÁî®ÁöÑÂõæÂÉèÊ®°ÂûãÔºåËØ∑ÂÖàÂú®AIÊ®°ÂûãÁÆ°ÁêÜ‰∏≠Ê∑ªÂä†ÂõæÂÉèÊ®°Âûã
                                        </span>
                                        <span x-show="imageModels.length > 0" class="text-green-600">
                                            <i class="fas fa-check-circle mr-1"></i>
                                            ÊâæÂà∞ <span x-text="imageModels.length"></span> ‰∏™ÂèØÁî®ÁöÑÂõæÂÉèÊ®°Âûã
                                        </span>
                                    </p>
                                </div>
                                
                                <!-- È¢ÑËßàÂºÄÂÖ≥ -->
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700">È¢ÑËßàÊ®°Âºè</label>
                                        <p class="text-xs text-gray-500">ÂºÄÂêØÂêéÂèØÈ¢ÑËßàÂíåÁºñËæëÁîüÊàêÁöÑÂ∏ñÊñáÂÜÖÂÆπ</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" x-model="showPostPreview" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                    </label>
                                </div>
                                
                                <button @click="generatePosts()" 
                                        :disabled="!selectedAIModelForPosts || postGenerationCount < 1"
                                        class="w-full bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white py-2 rounded-lg transition-colors">
                                    <i class="fas fa-magic mr-2"></i>
                                    <span x-text="showPostPreview ? 'ÁîüÊàêÂ∏ñÊñáÈ¢ÑËßà' : 'Áõ¥Êé•ÁîüÊàêÂ∏ñÊñá'"></span>
                                </button>
                            </div>
                            
                            <!-- Â∏ñÊñáÈ¢ÑËßàÂå∫Âüü -->
                            <div x-show="previewPosts.length > 0" class="border-t">
                                <div class="p-4 bg-green-50 border-b">
                                    <div class="flex justify-between items-center">
                                        <h4 class="font-medium text-green-800">
                                            <i class="fas fa-eye mr-2"></i>
                                            Â∏ñÊñáÈ¢ÑËßà (<span x-text="previewPosts.length"></span>‰∏™)
                                        </h4>
                                        <div class="flex space-x-2">
                                            <button @click="savePreviewPosts()" 
                                                    class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                                <i class="fas fa-save mr-1"></i>‰øùÂ≠òÂÖ®ÈÉ®
                                            </button>
                                            <button @click="clearPreviewPosts()" 
                                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                                <i class="fas fa-trash mr-1"></i>Ê∏ÖÁ©∫
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 max-h-96 overflow-y-auto">
                                    <div class="space-y-3">
                                        <template x-for="(post, index) in previewPosts" :key="index">
                                            <div class="border border-gray-200 rounded-lg p-3 transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg">
                                                <div class="flex justify-between items-start mb-2">
                                                    <div class="flex-1">
                                                        <h5 class="font-medium text-sm mb-1" x-text="post.title"></h5>
                                                        <div class="flex items-center text-xs text-gray-500 space-x-2">
                                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded" x-text="post.category"></span>
                                                            <span x-text="'‰ΩúËÄÖ: ' + post.authorName"></span>
                                                            <span x-show="post.hasAIGeneratedImage" class="bg-purple-100 text-purple-800 px-2 py-1 rounded">
                                                                <i class="fas fa-image mr-1"></i>AIÂõæÁâá
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <button @click="removePreviewPost(index)" 
                                                            class="text-red-500 hover:text-red-700 p-1">
                                                        <i class="fas fa-times text-xs"></i>
                                                    </button>
                                                </div>
                                                
                                                <!-- AIÁîüÊàêÁöÑÂõæÁâáÈ¢ÑËßà -->
                                                <div x-show="post.images && post.images.length > 0" class="mb-3">
                                                    <div class="grid grid-cols-2 gap-2">
                                                        <template x-for="(image, imgIndex) in post.images.slice(0, 4)" :key="imgIndex">
                                                            <div class="relative group">
                                                                <img :src="image" 
                                                                     :alt="'AIÁîüÊàêÂõæÁâá ' + (imgIndex + 1)"
                                                                     class="w-full h-20 object-cover rounded border cursor-pointer hover:opacity-80 transition-opacity"
                                                                     @click="window.open(image, '_blank')">
                                                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all rounded flex items-center justify-center">
                                                                    <i class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                                                </div>
                                                            </div>
                                                        </template>
                                                    </div>
                                                    <div x-show="post.imagePrompt" class="mt-2 text-xs text-gray-500 bg-gray-50 p-2 rounded">
                                                        <strong>ÂõæÂÉèÊèêÁ§∫ËØç:</strong> <span x-text="post.imagePrompt"></span>
                                                    </div>
                                                </div>
                                                
                                                <div class="text-xs text-gray-600">
                                                    <div class="overflow-hidden max-w-full whitespace-pre-line text-sm leading-relaxed" x-text="post.content.length > 150 ? post.content.substring(0, 150) + '...' : post.content"></div>
                                                    <div class="mt-2 flex flex-wrap gap-1">
                                                        <template x-for="tag in (post.tags || [])" :key="tag">
                                                            <span class="bg-gray-100 text-gray-600 px-1 py-0.5 rounded text-xs" x-text="'#' + tag"></span>
                                                        </template>
                                                    </div>
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Ê®°ÊÄÅÊ°ÜÁªÑ‰ª∂ -->
    <!-- Áî®Êà∑ÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div x-show="showUserModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-lg m-4 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 z-10">
                <h3 class="text-lg font-semibold" x-text="editingUser ? 'ÁºñËæëÁî®Êà∑' : 'Ê∑ªÂä†Áî®Êà∑'"></h3>
            </div>
            
            <form @submit.prevent="saveUser()" class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Â∑¶‰æßÔºöÂü∫Êú¨‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">Âü∫Êú¨‰ø°ÊÅØ</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊòµÁß∞ <span class="text-red-500">*</span></label>
                            <input type="text" x-model="userForm.nickName" required maxlength="50"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <div class="text-xs text-gray-500 mt-1" x-text="(userForm.nickName || '').length + '/50'"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Â§¥ÂÉèURL</label>
                            <input type="url" x-model="userForm.avatarUrl" 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="https://example.com/avatar.jpg">
                            <div x-show="userForm.avatarUrl" class="mt-2">
                                <img :src="userForm.avatarUrl" class="w-16 h-16 rounded-full object-cover border" 
                                     @error="$el.style.display='none'">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‰∏™‰∫∫ÁÆÄ‰ªã</label>
                            <textarea x-model="userForm.bio" rows="3" maxlength="200"
                                      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="ÂàÜ‰∫´‰∏Ä‰∏ãÊÇ®‰∏éÂÆ†Áâ©ÁöÑÊïÖ‰∫ã..."></textarea>
                            <div class="text-xs text-gray-500 mt-1" x-text="(userForm.bio || '').length + '/200'"></div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÊÄßÂà´</label>
                                <select x-model="userForm.gender" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Êú™ËÆæÁΩÆ</option>
                                    <option value="male">Áî∑</option>
                                    <option value="female">Â•≥</option>
                                    <option value="unknown">‰∏ç‰æøÈÄèÈú≤</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Áä∂ÊÄÅ</label>
                                <select x-model="userForm.status" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="active">Ê¥ªË∑É</option>
                                    <option value="inactive">Á¶ÅÁî®</option>
                                    <option value="suspended">ÊöÇÂÅú</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÁîüÊó•</label>
                            <input type="date" x-model="userForm.birthday" 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PetMeet ID</label>
                            <input type="text" x-model="userForm.PetMeetID" 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="ÁïôÁ©∫Â∞ÜËá™Âä®ÁîüÊàê"
                                   :readonly="editingUser">
                            <p class="text-xs text-gray-500 mt-1">ÁºñËæëÊ®°Âºè‰∏ã‰∏çÂèØ‰øÆÊîπ</p>
                        </div>
                    </div>
                    
                    <!-- Âè≥‰æßÔºö‰ΩçÁΩÆÂíåÂÖ∂‰ªñ‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">‰ΩçÁΩÆ‰ø°ÊÅØ</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂõΩÂÆ∂</label>
                            <input type="text" x-model="userForm.country" 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="‰æãÂ¶ÇÔºö‰∏≠ÂõΩ">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÁúÅ‰ªΩ</label>
                                <input type="text" x-model="userForm.province" 
                                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="‰æãÂ¶ÇÔºöÂπø‰∏úÁúÅ">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÂüéÂ∏Ç</label>
                                <input type="text" x-model="userForm.city" 
                                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="‰æãÂ¶ÇÔºöÊ∑±Âú≥">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ËØ≠Ë®Ä</label>
                            <select x-model="userForm.language" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="zh_CN">ÁÆÄ‰Ωì‰∏≠Êñá</option>
                                <option value="zh_TW">ÁπÅ‰Ωì‰∏≠Êñá</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                        
                        <h4 class="font-medium text-gray-800 border-b pb-2 mt-6">Á≥ªÁªü‰ø°ÊÅØ</h4>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Áî®Êà∑Á≠âÁ∫ß</label>
                                <input type="number" x-model="userForm.level" min="1" max="100"
                                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="1">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÁªèÈ™åÂÄº</label>
                                <input type="number" x-model="userForm.experience" min="0"
                                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="0">
                            </div>
                        </div>
                        
                        <!-- AIÁîüÊàêÊ†áËØÜ -->
                        <div class="p-3 bg-gray-50 rounded border">
                            <h5 class="font-medium text-gray-700 mb-2">
                                <i class="fas fa-robot mr-2"></i>AIÊ†áËØÜ‰ø°ÊÅØ
                            </h5>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">ÊòØÂê¶AIÁîüÊàê</label>
                                    <div class="flex items-center">
                                        <input type="checkbox" x-model="userForm.isAIGenerated" class="mr-2">
                                        <span class="text-sm" x-text="userForm.isAIGenerated ? 'AIÁîüÊàêÁî®Êà∑' : 'ÁúüÂÆûÁî®Êà∑'"></span>
                                    </div>
                                </div>
                                <div x-show="userForm.isAIGenerated">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">AIÊ®°Âûã</label>
                                    <input type="text" x-model="userForm.aiModel" 
                                           class="w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"
                                           placeholder="‰æãÂ¶ÇÔºödeepseek-r1">
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÂæÆ‰ø°‰ø°ÊÅØÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ -->
                        <div class="p-3 bg-blue-50 rounded border">
                            <h5 class="font-medium text-blue-700 mb-2">
                                <i class="fab fa-weixin mr-2"></i>ÂæÆ‰ø°‰ø°ÊÅØ
                            </h5>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1">OpenID</label>
                                <input type="text" x-model="userForm._openid" 
                                       class="w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"
                                       placeholder="ÂæÆ‰ø°Áî®Êà∑ÂîØ‰∏ÄÊ†áËØÜ"
                                       :readonly="editingUser">
                                <p class="text-xs text-gray-500 mt-1">ÁºñËæëÊ®°Âºè‰∏ã‰∏çÂèØ‰øÆÊîπ</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÂÆ†Áâ©‰ø°ÊÅØÂå∫Âüü -->
                <div class="mt-6 p-4 bg-pink-50 rounded-lg border">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="font-medium text-gray-800">
                            <i class="fas fa-paw mr-2"></i>ÂÆ†Áâ©‰ø°ÊÅØÁÆ°ÁêÜ
                        </h4>
                        <button type="button" @click="openPetModal()" 
                                :disabled="!editingUser"
                                class="bg-pink-500 hover:bg-pink-600 disabled:bg-gray-300 text-white px-3 py-1 rounded text-sm transition-colors">
                            <i class="fas fa-plus mr-1"></i>Ê∑ªÂä†ÂÆ†Áâ©
                        </button>
                    </div>
                    
                    <!-- ÂÆ†Áâ©ÂàóË°® -->
                    <div x-show="editingUser" class="space-y-3">
                        <div x-show="loadingPets" class="text-center py-4">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-pink-500 mx-auto"></div>
                            <p class="text-sm text-gray-500 mt-2">Âä†ËΩΩÂÆ†Áâ©‰ø°ÊÅØ‰∏≠...</p>
                        </div>
                        
                        <div x-show="!loadingPets && currentUserPets.length > 0">
                            <template x-for="(pet, index) in currentUserPets" :key="pet._id">
                                <div class="bg-white rounded-lg p-3 border hover:shadow-md transition-shadow">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="flex-1">
                                            <h5 class="font-medium text-sm flex items-center">
                                                <i class="fas fa-paw text-pink-500 mr-2"></i>
                                                <span x-text="pet.name"></span>
                                                <span class="ml-2 bg-pink-100 text-pink-800 px-2 py-1 rounded text-xs" 
                                                      x-text="getPetCategoryName(pet.category)"></span>
                                            </h5>
                                            <div class="text-xs text-gray-600 mt-1">
                                                <span x-show="pet.breed" class="mr-3">
                                                    <strong>ÂìÅÁßç:</strong> <span x-text="pet.breed"></span>
                                                </span>
                                                <span x-show="pet.age" class="mr-3">
                                                    <strong>Âπ¥ÈæÑ:</strong> <span x-text="pet.age"></span>
                                                </span>
                                                <span x-show="pet.gender" class="mr-3">
                                                    <strong>ÊÄßÂà´:</strong> <span x-text="pet.gender === 'male' ? 'ÂÖ¨' : (pet.gender === 'female' ? 'ÊØç' : pet.gender)"></span>
                                                </span>
                                                <span x-show="pet.weight" class="mr-3">
                                                    <strong>‰ΩìÈáç:</strong> <span x-text="pet.weight"></span>
                                                </span>
                                            </div>
                                            <div x-show="pet.description" class="text-xs text-gray-500 mt-1">
                                                <strong>ÊèèËø∞:</strong> <span x-text="pet.description"></span>
                                            </div>
                                        </div>
                                        <div class="flex space-x-1 ml-2">
                                            <button type="button" @click="editPet(pet)" 
                                                    class="text-blue-600 hover:text-blue-800 p-1">
                                                <i class="fas fa-edit text-xs"></i>
                                            </button>
                                            <button type="button" @click="deletePet(pet._id)" 
                                                    class="text-red-500 hover:text-red-700 p-1">
                                                <i class="fas fa-trash text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- ÂÅ•Â∫∑Áä∂ÊÄÅÊåáÁ§∫Âô® -->
                                    <div class="flex space-x-2 mt-2">
                                        <span x-show="pet.vaccinated" class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
                                            <i class="fas fa-shield-virus mr-1"></i>Â∑≤Áñ´Ëãó
                                        </span>
                                        <span x-show="pet.neutered" class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                            <i class="fas fa-cut mr-1"></i>Â∑≤ÁªùËÇ≤
                                        </span>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <div x-show="!loadingPets && currentUserPets.length === 0" class="text-center text-gray-500 py-4">
                            <i class="fas fa-paw text-gray-300 text-2xl mb-2"></i>
                            <p>ËØ•Áî®Êà∑ÊöÇÊú™Ê∑ªÂä†ÂÆ†Áâ©‰ø°ÊÅØ</p>
                            <button type="button" @click="openPetModal()" 
                                    class="mt-2 text-pink-600 hover:text-pink-800 text-sm">
                                ÁÇπÂáªÊ∑ªÂä†Á¨¨‰∏ÄÂè™ÂÆ†Áâ©
                            </button>
                        </div>
                    </div>
                    
                    <div x-show="!editingUser" class="text-center text-gray-500 py-4">
                        ËØ∑ÂÖàÈÄâÊã©ÊàñÂàõÂª∫Áî®Êà∑ÂêéÁÆ°ÁêÜÂÆ†Áâ©‰ø°ÊÅØ
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" @click="closeUserModal()" 
                            class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">
                        ÂèñÊ∂à
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
                        ‰øùÂ≠ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Â∏ñÊñáÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div x-show="showPostModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-lg m-4 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 z-10">
                <h3 class="text-lg font-semibold" x-text="editingPost ? 'ÁºñËæëÂ∏ñÊñá' : 'Ê∑ªÂä†Â∏ñÊñá'"></h3>
            </div>
            
            <form @submit.prevent="savePost()" class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Â∑¶‰æßÔºöÂü∫Êú¨‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">Âü∫Êú¨‰ø°ÊÅØ</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ê†áÈ¢ò</label>
                            <input type="text" x-model="postForm.title" required maxlength="50"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <div class="text-xs text-gray-500 mt-1" x-text="(postForm.title || '').length + '/50'"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂÜÖÂÆπ</label>
                            <textarea x-model="postForm.content" required rows="4" maxlength="2000"
                                      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            <div class="text-xs text-gray-500 mt-1" x-text="(postForm.content || '').length + '/2000'"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÈïøÊñáÂÜÖÂÆπÔºàÂèØÈÄâÔºâ</label>
                            <textarea x-model="postForm.longPost" rows="3"
                                      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="ÂèØ‰ª•Âú®ËøôÈáåÂÜôÊõ¥ËØ¶ÁªÜÁöÑÂÜÖÂÆπ..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÊùÉÈôêËÆæÁΩÆ</label>
                                <select x-model="postForm.permission" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="public">ÂÖ¨ÂºÄ</option>
                                    <option value="friends">‰ªÖÂ•ΩÂèã</option>
                                    <option value="private">ÁßÅÂØÜ</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÂÜÖÂÆπÁ±ªÂûã</label>
                                <select x-model="postForm.contentType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="standard">Ê†áÂáÜÂÜÖÂÆπ</option>
                                    <option value="adult">Êàê‰∫∫ÂÜÖÂÆπ</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Áä∂ÊÄÅ</label>
                            <select x-model="postForm.status" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="approved">Â∑≤ÂèëÂ∏É</option>
                                <option value="pending">ÂæÖÂÆ°Ê†∏</option>
                                <option value="draft">ËçâÁ®ø</option>
                                <option value="rejected">Â∑≤ÊãíÁªù</option>
                            </select>
                        </div>
                        
                        <!-- AIÁîüÊàêÁõ∏ÂÖ≥Â≠óÊÆµÔºàÊòæÁ§∫Áî®Ôºâ -->
                        <div class="mt-4 p-3 bg-gray-50 rounded border">
                            <h5 class="font-medium text-gray-700 mb-2">
                                <i class="fas fa-robot mr-2"></i>AIÊ†áËØÜ‰ø°ÊÅØ
                            </h5>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">ÊòØÂê¶AIÁîüÊàê</label>
                                    <div class="text-sm text-gray-800">
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                            ÊâãÂä®ÂàõÂª∫
                                        </span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">ÁîüÊàêÊ®°Âûã</label>
                                    <div class="text-sm text-gray-500">-</div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                ÊâãÂä®ÂàõÂª∫ÁöÑÂ∏ñÊñáÂ∞ÜËá™Âä®Ê†áËÆ∞‰∏∫ÈùûAIÁîüÊàêÂÜÖÂÆπ
                            </p>
                        </div>
                        
                        <!-- ÂàÜÁ±ªËÆæÁΩÆ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Â∏ñÊñáÂàÜÁ±ª</label>
                            <select x-model="postForm.category" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="ÁÆ°ÁêÜÂëòÂàõÂª∫">ÁÆ°ÁêÜÂëòÂàõÂª∫</option>
                                <option value="Êó•Â∏∏ÂàÜ‰∫´">Êó•Â∏∏ÂàÜ‰∫´</option>
                                <option value="ÂÅ•Â∫∑Âí®ËØ¢">ÂÅ•Â∫∑Âí®ËØ¢</option>
                                <option value="ËÆ≠ÁªÉÊäÄÂ∑ß">ËÆ≠ÁªÉÊäÄÂ∑ß</option>
                                <option value="ÁæéÈ£üÊé®Ëçê">ÁæéÈ£üÊé®Ëçê</option>
                                <option value="Áî®ÂìÅÊµãËØÑ">Áî®ÂìÅÊµãËØÑ</option>
                                <option value="Ë∂£‰∫ãÂàÜ‰∫´">Ë∂£‰∫ãÂàÜ‰∫´</option>
                                <option value="Ê±ÇÂä©ÈóÆÁ≠î">Ê±ÇÂä©ÈóÆÁ≠î</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Âè≥‰æßÔºöÈôÑÂä†‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">ÈôÑÂä†‰ø°ÊÅØ</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‰ΩúËÄÖ</label>
                            <select x-model="postForm.authorId" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">ËØ∑ÈÄâÊã©‰ΩúËÄÖ</option>
                                <template x-for="user in users" :key="user._id">
                                    <option :value="user._id" x-text="user.nickName + ' (ID: ' + (user.PetMeetID || user._id) + ')'"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ËØùÈ¢òÊ†áÁ≠æ</label>
                            <div class="flex flex-wrap gap-1 mb-2" x-show="postForm.topics && postForm.topics.length > 0">
                                <template x-for="(topic, index) in postForm.topics" :key="index">
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs flex items-center">
                                        #<span x-text="topic"></span>
                                        <button type="button" @click="removePostTopic(index)" class="ml-1 text-blue-600 hover:text-blue-800">√ó</button>
                                    </span>
                                </template>
                            </div>
                            <div class="flex">
                                <input type="text" x-model="newPostTopic" @keyup.enter="addPostTopic()" 
                                       placeholder="ËæìÂÖ•ËØùÈ¢òÊ†áÁ≠æÂêéÊåâÂõûËΩ¶"
                                       class="flex-1 px-3 py-2 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button type="button" @click="addPostTopic()" 
                                        class="px-3 py-2 bg-blue-500 text-white rounded-r-lg hover:bg-blue-600">
                                    Ê∑ªÂä†
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Âú∞ÁêÜ‰ΩçÁΩÆÔºàÂèØÈÄâÔºâ</label>
                            <div x-show="postForm.location" class="mb-2 p-2 bg-gray-50 rounded border">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-medium text-sm" x-text="postForm.location?.name"></div>
                                        <div class="text-xs text-gray-500" x-text="postForm.location?.address"></div>
                                    </div>
                                    <button type="button" @click="removePostLocation()" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <input type="text" x-model="postLocationSearch" @keyup.enter="searchPostLocation()" 
                                   placeholder="ÊêúÁ¥¢Âú∞ÁÇπÂêçÁß∞"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button type="button" @click="searchPostLocation()" 
                                    class="mt-2 px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                                ÊêúÁ¥¢Âú∞ÁÇπ
                            </button>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂõæÁâá‰∏ä‰º†</label>
                            <div class="grid grid-cols-3 gap-2 mb-2" x-show="postForm.images && postForm.images.length > 0">
                                <template x-for="(image, index) in postForm.images" :key="index">
                                    <div class="relative group">
                                        <img :src="image" class="w-full h-20 object-cover rounded border cursor-pointer"
                                             @click="previewPostImage(image)">
                                        <button type="button" @click="removePostImage(index)" 
                                                class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                                            √ó
                                        </button>
                                    </div>
                                </template>
                            </div>
                            <input type="file" multiple accept="image/*" @change="handlePostImageUpload($event)" 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <p class="text-xs text-gray-500 mt-1">ÊîØÊåÅÂ§öÂº†ÂõæÁâá‰∏ä‰º†ÔºåÊúÄÂ§ö9Âº†</p>
                        </div>
                    </div>
                </div>
                
                <!-- Êàê‰∫∫ÂÜÖÂÆπÈÖçÁßçË¶ÅÊ±Ç -->
                <div x-show="postForm.contentType === 'adult'" x-transition class="mt-6 p-4 bg-pink-50 rounded-lg border">
                    <h4 class="font-medium text-gray-800 mb-3">
                        <i class="fas fa-dna mr-2"></i>ÈÖçÁßçË¶ÅÊ±ÇËÆæÁΩÆ
                    </h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‰ΩìÂûãË¶ÅÊ±Ç</label>
                            <select x-model="postForm.breedingRequirements.size" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="any">‰∏çÈôê</option>
                                <option value="small">Â∞èÂûã</option>
                                <option value="medium">‰∏≠Âûã</option>
                                <option value="large">Â§ßÂûã</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Áñ´ËãóË¶ÅÊ±Ç</label>
                            <select x-model="postForm.breedingRequirements.vaccine" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="any">‰∏çÈôê</option>
                                <option value="required">ÂøÖÈ°ªÊé•Áßç</option>
                                <option value="preferred">‰ºòÂÖàÊé•Áßç</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Âπ¥ÈæÑË¶ÅÊ±Ç</label>
                            <select x-model="postForm.breedingRequirements.age" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="any">‰∏çÈôê</option>
                                <option value="young">ÂπºÂπ¥</option>
                                <option value="adult">ÊàêÂπ¥</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂìÅÁßçË¶ÅÊ±Ç</label>
                            <input type="text" x-model="postForm.breedingRequirements.breed" 
                                   placeholder="ÊåáÂÆöÂìÅÁßçÊàñÁïôÁ©∫"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÂÖ∂‰ªñË¶ÅÊ±Ç</label>
                        <textarea x-model="postForm.breedingRequirements.additional" rows="2" maxlength="300"
                                  placeholder="ÂÖ∂‰ªñÁâπÊÆäË¶ÅÊ±Ç..."
                                  class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"></textarea>
                        <div class="text-xs text-gray-500 mt-1" x-text="(postForm.breedingRequirements.additional || '').length + '/300'"></div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" @click="closePostModal()" 
                            class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">
                        ÂèñÊ∂à
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
                        ‰øùÂ≠ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- AIÊ®°ÂûãÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div x-show="showAIModelModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-4xl max-h-screen overflow-y-auto">
            <h3 class="text-lg font-semibold mb-4" x-text="editingAIModel ? 'ÁºñËæëAIÊ®°Âûã' : 'Ê∑ªÂä†AIÊ®°Âûã'"></h3>
            
            <!-- Êô∫ËÉΩ‰ª£Á†ÅËß£ÊûêÂå∫Âüü -->
            <div x-show="!editingAIModel" class="mb-6 p-4 bg-blue-50 rounded-lg border">
                <div class="flex items-center justify-between mb-3">
                    <h4 class="font-medium text-blue-800">
                        <i class="fas fa-code mr-2"></i>Êô∫ËÉΩSDK‰ª£Á†ÅËß£Êûê
                    </h4>
                    <button @click="showCodeParser = !showCodeParser" 
                            class="text-blue-600 hover:text-blue-800 text-sm">
                        <span x-text="showCodeParser ? 'ÈöêËóè' : 'Â±ïÂºÄ'"></span>
                        <i :class="showCodeParser ? 'fas fa-chevron-up' : 'fas fa-chevron-down'" class="ml-1"></i>
                    </button>
                </div>
                
                <div x-show="showCodeParser" x-transition>
                    <p class="text-sm text-blue-700 mb-3">
                        Á≤òË¥¥ÊÇ®ÁöÑSDKÁ§∫‰æã‰ª£Á†ÅÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®ÊèêÂèñÊ®°ÂûãÈÖçÁΩÆ‰ø°ÊÅØ
                    </p>
                    
                    <div class="space-y-3">
                        <textarea x-model="sdkCode" 
                                  placeholder="Á≤òË¥¥ÊÇ®ÁöÑSDK‰ª£Á†Å..."
                                  class="w-full h-32 px-3 py-2 border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                                  style="font-family: 'Courier New', monospace;"></textarea>
                        
                        <div class="flex space-x-3">
                            <button @click="parseSDKCode()" 
                                    :disabled="!sdkCode.trim()"
                                    class="bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                <i class="fas fa-magic mr-2"></i>Ëß£Êûê‰ª£Á†Å
                            </button>
                            
                            <button @click="sdkCode = ''; parsedModelInfo = null" 
                                    class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                <i class="fas fa-times mr-2"></i>Ê∏ÖÁ©∫
                            </button>
                        </div>
                        
                        <!-- Ëß£ÊûêÁªìÊûúÈ¢ÑËßà -->
                        <div x-show="parsedModelInfo" x-transition class="bg-green-50 border border-green-200 rounded-lg p-3">
                            <h5 class="font-medium text-green-800 mb-2">
                                <i class="fas fa-check-circle mr-2"></i>Ëß£ÊûêÊàêÂäü
                            </h5>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div><strong>Ê®°Âûã:</strong> <span x-text="parsedModelInfo?.model"></span></div>
                                <div><strong>Êèê‰æõÂïÜ:</strong> <span x-text="parsedModelInfo?.provider"></span></div>
                                <div><strong>Á±ªÂûã:</strong> <span x-text="parsedModelInfo?.type"></span></div>
                                <div><strong>ÊµÅÂºèÊîØÊåÅ:</strong> <span x-text="parsedModelInfo?.supportsStreaming ? 'ÊòØ' : 'Âê¶'"></span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <form @submit.prevent="saveAIModel()">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h5 class="font-medium text-gray-800 border-b pb-2">Âü∫Êú¨‰ø°ÊÅØ</h5>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ê®°ÂûãÂêçÁß∞</label>
                            <input type="text" x-model="aiModelForm.name" required 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊèèËø∞</label>
                            <textarea x-model="aiModelForm.description" rows="3"
                                      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Á±ªÂûã</label>
                                <select x-model="aiModelForm.type" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="text">ÊñáÊú¨Ê®°Âûã</option>
                                    <option value="image">ÂõæÂÉèÊ®°Âûã</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Áä∂ÊÄÅ</label>
                                <select x-model="aiModelForm.status" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="active">ÂêØÁî®</option>
                                    <option value="inactive">Á¶ÅÁî®</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÊäÄÊúØÈÖçÁΩÆ -->
                    <div class="space-y-4">
                        <h5 class="font-medium text-gray-800 border-b pb-2">ÊäÄÊúØÈÖçÁΩÆ</h5>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ê®°ÂûãÊ†áËØÜ</label>
                            <input type="text" x-model="aiModelForm.model" required 
                                   placeholder="‰æãÂ¶Ç: gpt-4, deepseek-r1"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">APIÂú∞ÂùÄ</label>
                            <input type="url" x-model="aiModelForm.baseURL" required 
                                   placeholder="https://api.example.com/v1"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Êèê‰æõÂïÜ</label>
                            <input type="text" x-model="aiModelForm.provider" 
                                   placeholder="‰æãÂ¶Ç: openai, deepseek"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÁâàÊú¨</label>
                            <input type="text" x-model="aiModelForm.version" 
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- APIÂØÜÈí•ÈÖçÁΩÆ -->
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h5 class="font-medium text-gray-800 mb-3">
                        <i class="fas fa-key mr-2"></i>APIÂØÜÈí•ÈÖçÁΩÆ
                    </h5>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©ÁéØÂ¢ÉÂèòÈáè</label>
                            <select x-model="selectedApiKey" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">ÈÄâÊã©Â∑≤ÊúâÁöÑAPIÂØÜÈí•...</option>
                                <template x-for="key in availableApiKeys" :key="key.name">
                                    <option :value="key.name" 
                                            :class="!key.hasValue ? 'text-gray-400' : ''"
                                            x-text="key.name + ' - ' + key.description + (key.hasValue ? ' ‚úì' : ' ‚úó')"></option>
                                </template>
                            </select>
                            
                            <!-- ÊòæÁ§∫ÈÄâ‰∏≠ÂØÜÈí•ÁöÑÈ¢ÑËßà -->
                            <div x-show="selectedApiKey" class="mt-2 text-xs text-gray-600">
                                <template x-for="key in availableApiKeys" :key="key.name">
                                    <div x-show="selectedApiKey === key.name">
                                        <span x-show="key.hasValue" class="text-green-600">
                                            ‚úì ÂØÜÈí•ÂèØÁî®: <code x-text="key.preview"></code>
                                        </span>
                                        <span x-show="!key.hasValue" class="text-red-600">
                                            ‚úó ÂØÜÈí•Êú™ËÆæÁΩÆÊàñ‰∏∫Á©∫
                                        </span>
                                    </div>
                                </template>
                            </div>
                            
                            <button type="button" @click="applySelectedApiKey()" 
                                    :disabled="!selectedApiKey"
                                    class="mt-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white px-3 py-1 rounded text-sm transition-colors">
                                Â∫îÁî®ÈÄâÊã©ÁöÑÂØÜÈí•
                            </button>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊàñÁõ¥Êé•ËæìÂÖ•APIÂØÜÈí•</label>
                            <input type="password" x-model="aiModelForm.apiKey" 
                                   placeholder="sk-... Êàñ ÁéØÂ¢ÉÂèòÈáèÂêç"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <p class="text-xs text-gray-500 mt-1">
                                ÊîØÊåÅÁõ¥Êé•ËæìÂÖ•ÂØÜÈí•ÊàñÁéØÂ¢ÉÂèòÈáèÂêçÔºàÂ¶Ç OPENAI_API_KEYÔºâ
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- È´òÁ∫ßÈÖçÁΩÆ -->
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h5 class="font-medium text-gray-800 mb-3">
                        <i class="fas fa-cog mr-2"></i>È´òÁ∫ßÈÖçÁΩÆ
                    </h5>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊúÄÂ§ßTokenÊï∞</label>
                            <input type="number" x-model="aiModelForm.config.max_tokens" min="1" max="32000"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÈªòËÆ§Ê∏©Â∫¶</label>
                            <input type="number" x-model="aiModelForm.config.temperature" min="0" max="2" step="0.1"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="aiModelForm.config.supportsStreaming" class="mr-2">
                                <span class="text-sm">ÊîØÊåÅÊµÅÂºèËæìÂá∫</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" x-model="aiModelForm.config.supportsThinking" class="mr-2">
                                <span class="text-sm">ÊîØÊåÅÊÄùÁª¥ÈìæÊé®ÁêÜ</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- È¢ÑËßàÁîüÊàêÁöÑID -->
                <div x-show="aiModelForm.type && aiModelForm.provider && aiModelForm.model" class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm text-blue-700">
                        <strong>ÁîüÊàêÁöÑÊ®°ÂûãID:</strong> 
                        <code class="bg-blue-100 px-2 py-1 rounded text-xs" x-text="generateModelId()"></code>
                    </p>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" @click="closeAIModelModal()" 
                            class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">
                        ÂèñÊ∂à
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg">
                        ‰øùÂ≠ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Âä†ËΩΩÊåáÁ§∫Âô® -->
    <div x-show="loading" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
            <span>Âä†ËΩΩ‰∏≠...</span>
        </div>
    </div>

    <!-- ÂÆ†Áâ©‰ø°ÊÅØÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div x-show="showPetModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-lg m-4 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 z-10">
                <h3 class="text-lg font-semibold" x-text="editingPet ? 'ÁºñËæëÂÆ†Áâ©‰ø°ÊÅØ' : 'Ê∑ªÂä†ÂÆ†Áâ©‰ø°ÊÅØ'"></h3>
            </div>
            
            <form @submit.prevent="savePet()" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Â∑¶‰æßÔºöÂü∫Êú¨‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">Âü∫Êú¨‰ø°ÊÅØ</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂÆ†Áâ©ÂêçÁß∞ <span class="text-red-500">*</span></label>
                            <input type="text" x-model="petForm.name" required maxlength="50"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂÆ†Áâ©Á±ªÂà´ <span class="text-red-500">*</span></label>
                            <select x-model="petForm.category" required class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="">ËØ∑ÈÄâÊã©Á±ªÂà´</option>
                                <option value="dog">Áãó</option>
                                <option value="cat">Áå´</option>
                                <option value="bird">È∏ü</option>
                                <option value="fish">È±º</option>
                                <option value="rabbit">ÂÖîÂ≠ê</option>
                                <option value="hamster">‰ªìÈº†</option>
                                <option value="other">ÂÖ∂‰ªñ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÂìÅÁßç</label>
                            <input type="text" x-model="petForm.breed" maxlength="50"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                                   placeholder="‰æãÂ¶ÇÔºöÈáëÊØõ„ÄÅÂ∏ÉÂÅ∂Áå´„ÄÅÈæôÁå´">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÊÄßÂà´</label>
                                <select x-model="petForm.gender" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                                    <option value="">Êú™Áü•</option>
                                    <option value="male">ÂÖ¨</option>
                                    <option value="female">ÊØç</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Âπ¥ÈæÑ</label>
                                <input type="text" x-model="petForm.age" maxlength="20"
                                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                                       placeholder="‰æãÂ¶ÇÔºö2Â≤Å„ÄÅ3‰∏™Êúà">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Âè≥‰æßÔºöËØ¶ÁªÜ‰ø°ÊÅØ -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-800 border-b pb-2">ËØ¶ÁªÜ‰ø°ÊÅØ</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‰ΩìÈáç</label>
                            <input type="text" x-model="petForm.weight" maxlength="20"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                                   placeholder="‰æãÂ¶ÇÔºö5kg„ÄÅ2.5ÂÖ¨Êñ§">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÁîüÊó•</label>
                            <input type="date" x-model="petForm.birthDate"
                                   class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÊèèËø∞</label>
                            <textarea x-model="petForm.description" rows="3" maxlength="200"
                                      class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                                      placeholder="ÊèèËø∞ÂÆ†Áâ©ÁöÑÁâπÂæÅ„ÄÅÊÄßÊ†ºÁ≠â..."></textarea>
                            <div class="text-xs text-gray-500 mt-1" x-text="(petForm.description || '').length + '/200'"></div>
                        </div>
                        
                        <div class="space-y-3">
                            <h5 class="font-medium text-gray-700">ÂÅ•Â∫∑Áä∂ÊÄÅ</h5>
                            
                            <div class="flex items-center">
                                <input type="checkbox" x-model="petForm.vaccinated" class="mr-2" id="vaccinated">
                                <label for="vaccinated" class="text-sm text-gray-700">
                                    <i class="fas fa-shield-virus text-green-600 mr-1"></i>
                                    Â∑≤Êé•ÁßçÁñ´Ëãó
                                </label>
                            </div>
                            
                            <div class="flex items-center">
                                <input type="checkbox" x-model="petForm.neutered" class="mr-2" id="neutered">
                                <label for="neutered" class="text-sm text-gray-700">
                                    <i class="fas fa-cut text-blue-600 mr-1"></i>
                                    Â∑≤ÁªùËÇ≤/ÂéªÂäø
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" @click="closePetModal()" 
                            class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">
                        ÂèñÊ∂à
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded-lg">
                        <i class="fas fa-save mr-2"></i>
                        ‰øùÂ≠ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/admin.js"></script>
</body>
</html> 